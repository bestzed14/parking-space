<div id="output">è¼‰å…¥ä¸­...</div>

<script>
 const city = "Taipei";
  const lat = 25.0338352;
  const lon = 121.5644995;
// å°ä¸­åº§æ¨™ 24.202133, 120.707060
//25.0338352   121.5644995
  // ç¬¬ä¸€æ­¥ï¼šæ›´æ–°è³‡æ–™
  fetch(`/update_PSA_CP/?city=${city}`)
    .then(res => {
      if (!res.ok) throw new Error("æ›´æ–°è³‡æ–™å¤±æ•—");
      return fetch(`/get_merged_parking_data/?city=${city}`);
    })
    .then(response => response.json())
    .then(result => {
      const data = result.data;
      const container = document.getElementById('output');

      if (!data.length) {
        container.innerHTML = 'âš ï¸ æŸ¥ç„¡è³‡æ–™';
        return;
      }

      container.innerHTML = `<h2>${city} åœè»Šå ´è³‡è¨Š</h2><ul>` +
        data.map(item => `
          <li>
            <strong>${item.name}</strong> (${item.car_park_id})<br>
            ğŸ“ ä½ç½®ï¼š${item.lat}, ${item.lon}<br>
            ğŸ“ åœ°å€:${item.address}<br>
            ğŸ“ æè¿°ï¼š${item.description || 'ç„¡'}<br>
            ğŸ“ è²»ç”¨ï¼š${item.faredescription || 'ç„¡'}<br>
            ğŸ“ é›»è©±ï¼š${item.emergency_phone || 'ç„¡'}<br>
            ğŸš— åœè»Šä½ï¼šå‰©é¤˜ ${item.available_spaces ?? 'ï¼Ÿ'} / ${item.total_spaces ?? 'ï¼Ÿ'}
          </li>
        `).join('') + '</ul>';

      return fetch(`/nearby_parking/?lat=${lat}&lon=${lon}&city=${city}`);
    })
    .then(res => res.json())
    .then(data => {
      console.log("âœ… æœ€è¿‘çš„åœè»Šå ´", data.data);
    })
    .catch(error => {
      console.error('âŒ éŒ¯èª¤:', error);
      document.getElementById('output').innerText = 'âš ï¸ ç™¼ç”ŸéŒ¯èª¤';
    });
  fetch(`/cheapest_nearby_parking/?lat=${lat}&lon=${lon}&city=${city}`)
  .then(res => res.json())
  .then(data => console.log("ğŸ’° æœ€ä¾¿å®œæœ€è¿‘çš„åœè»Šå ´ï¼š", data.data));
</script>
